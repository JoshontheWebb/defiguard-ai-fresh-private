<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFiGuard AI - Predictive DeFi Compliance Auditor</title>
    <meta name="description" content="Advanced AI-powered smart contract audits for DeFi protocols, outperforming industry standards with real-time insights and 2025 regulatory compliance.">
    <link rel="stylesheet" href="/static/styles.css?_=${Date.now()}">
    <style>
        .upgrade-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .upgrade-button:hover {
            background-color: #45a049;
        }
        .pricing-table {
            margin-top: 10px;
            border-collapse: collapse;
            width: 100%;
        }
        .pricing-table th, .pricing-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .pricing-table th {
            background-color: #f2f2f2;
        }
        .logout-link {
            color: var(--text-light);
            text-decoration: none;
            padding: clamp(10px, 1.5vw, 12px);
            display: block;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .logout-link:hover {
            background-color: rgba(52, 73, 94, 0.3);
            color: var(--accent-pink);
            outline: 2px solid var(--focus-outline);
            outline-offset: 2px;
        }
        .logout-container {
            display: none; /* Hidden by default */
        }
        .logged-in .logout-container {
            display: block; /* Shown when logged in */
        }
    </style>
</head>
<body>
    <!-- Hamburger Menu -->
    <div class="hamburger" id="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <img src="/static/images/defiguard-logo.png" alt="DeFiGuard Logo" class="logo-image">
            <span class="logo-text">DeFiGuard</span>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#audit">Audit Contract</a></li>
            <li><a href="#results">Results Dashboard</a></li>
            <li><a href="#settings">Settings</a></li>
            <li id="auth-status"><a href="/auth">Sign In / Create Account</a></li>
            <li class="logout-container">
                <a href="#" id="logout-sidebar" class="logout-link">Log Out</a>
            </li>
            <li><a href="https://discord.gg/defiguard" target="_blank">Community Support</a></li>
            <li class="priority-support" style="display: none;"><a href="mailto:support@defiguard.ai">Priority Support (Beginner/Pro)</a></li>
        </ul>
        <div class="tier-info" aria-live="polite">
            <span>Tier: Free (Limited audits)</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Hero Section -->
        <section id="home" class="hero">
            <h2>Secure Your DeFi Future with AI-Driven Audits</h2>
            <p>Outshine competitors: Analyze Solidity code against MiCA/SEC FIT21 regs, predict risks, and get actionable fixes faster and smarter than CertiK or ConsenSys.</p>
            <a href="#audit" class="cta-button">Start Audit Now</a>
        </section>

        <!-- Progress Tracker -->
        <section id="progress" class="progress-tracker" aria-label="Audit progress steps">
            <h3>Audit Workflow</h3>
            <ol>
                <li>Upload Contract (Solidity File)</li>
                <li>Optional: Add Contract Address</li>
                <li>AI Analysis (Slither + Grok)</li>
                <li>View Report & Recommendations</li>
            </ol>
        </section>

        <!-- Audit Submission Form -->
        <section id="audit" class="audit-section">
            <h2>Submit for Audit</h2>
            <form action="/audit" method="post" enctype="multipart/form-data">
                <label for="file">Upload Solidity File (.sol):</label>
                <input type="file" id="file" name="file" accept=".sol" required aria-describedby="file-help">
                <small id="file-help">Max size: Loading...</small>

                <label for="contract_address" class="pro-diamond-only" style="display: none;">Ethereum Contract Address (Optional):</label>
                <input type="text" id="contract_address" name="contract_address" placeholder="0x..." pattern="^0x[a-fA-F0-9]{40}$" style="display: none;">
                <small class="pro-diamond-only" style="display: none;">Fetch on-chain bytecode for deeper analysis (Pro/Diamond).</small>

                <label for="custom_report" class="pro-diamond-only" style="display: none;">Custom Compliance Report:</label>
                <textarea id="custom_report" name="custom_report" placeholder="Specify compliance requirements (Pro/Diamond)" style="display: none;"></textarea>

                <button type="submit">Audit Contract</button>
                <button type="button" id="diamond-audit" class="diamond-only" style="display: none;">Request Diamond Audit</button>
                <div class="loading">
                    <div class="progress-bar"><span class="progress-text">0%</span></div>
                    <p>Analyzing...</p>
                </div>
                <p id="diamond-price" class="diamond-only" style="display: none;">Diamond Audit Overage: Loading...</p>
            </form>
            <div class="usage-warning" aria-live="assertive">
                <!-- ID 1: Removed <p>Free tier: Limited audits.</p> -->
            </div>
            <div class="upgrade-prompt" aria-live="polite">
                <h4>Upgrade Your Plan</h4>
                <table class="pricing-table">
                    <thead>
                        <tr>
                            <th>Tier</th>
                            <th>Price</th>
                            <th>Features</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Beginner</td>
                            <td>$50/month</td>
                            <td>10 audits/mo, 1MB file limit, AI predictions, on-chain analysis, reports, priority support</td>
                        </tr>
                        <tr>
                            <td>Pro</td>
                            <td>$200/month</td>
                            <td>Unlimited audits, 1MB file limit, Diamond add-on access, fuzzing, API key, priority support</td>
                        </tr>
                        <tr>
                            <td>Diamond Add-on</td>
                            <td>$50/month (with Pro) + Overage: $0.50/MB (1-10MB), $1.00/MB (11-50MB), $2.00/MB (51-52MB), $5.00/MB (53+MB)</td>
                            <td>Unlimited file size, formal verification, exploit simulation, threat modeling, NFT rewards</td>
                        </tr>
                    </tbody>
                </table>
                <select id="tier-select" aria-label="Select subscription tier">
                    <option value="beginner">Beginner ($50/mo)</option>
                    <option value="pro">Pro ($200/mo)</option>
                    <option value="diamond">Diamond add-on ($50/mo with Pro + overage)</option>
                </select>
                <button id="tier-switch" class="upgrade-button" aria-label="Upgrade to selected tier">Upgrade Tier</button>
                <a id="upgrade-link" href="/upgrade">Upgrade for more features!</a>
            </div>
            <div class="tier-benefits" aria-live="polite">
                <h3>Tier Benefits</h3>
                <p id="tier-description">Loading tier information...</p>
                <p id="size-limit">Max file size: Loading...</p>
                <p id="features">Features: Loading...</p>
            </div>
            <div id="facet-preview" class="box pro-diamond-only" style="display: none;"></div>
            <div class="results">
                <p>Audit Results: (JSON response will appear here)</p>
                <button id="download-report" style="display: none;">Download Report (Beginner/Pro)</button>
            </div>
        </section>

        <!-- Results Dashboard -->
        <section id="results" class="results-dashboard" aria-label="Audit results">
            <h3>Audit Results</h3>
            <div class="risk-score-placeholder">
                <p>Risk Score: <span id="risk-score">N/A</span>/100</p>
            </div>

            <div class="issues-table-placeholder">
                <h4>Identified Issues</h4>
                <table role="table" aria-describedby="issues-desc">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Severity</th>
                            <th>Description</th>
                            <th>Fix</th>
                        </tr>
                    </thead>
                    <tbody id="issues-body">
                        <tr><td colspan="4">No issues yet submit an audit to see results.</td></tr>
                    </tbody>
                </table>
                <small id="issues-desc">Vulnerabilities classified by severity (Low/Med/High).</small>
            </div>

            <div class="predictions-placeholder">
                <h4>Risk Predictions</h4>
                <ul id="predictions-list">
                    <li>No predictions yet.</li>
                </ul>
            </div>

            <div class="recommendations-placeholder">
                <h4>Recommendations</h4>
                <ul id="recommendations-list">
                    <li>No recommendations yet.</li>
                </ul>
            </div>

            <div class="fuzzing-placeholder pro-diamond-only" style="display: none;">
                <h4>Fuzzing Results</h4>
                <ul id="fuzzing-list">
                    <li>No fuzzing results yet.</li>
                </ul>
            </div>

            <div class="remediation-placeholder diamond-only" style="display: none;">
                <h4>Remediation Roadmap</h4>
                <p id="remediation-roadmap">No roadmap yet.</p>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings">
            <h3>Account Settings</h3>
            <ul>
                <!-- ID 9: Removed <li>Upgrade Tier: <a href="/upgrade">Beginner ($50/mo), Pro ($200/mo), Diamond add-on ($50/mo with Pro + overage)</a></li> -->
                <li>View Usage History</li>
                <li id="api-key" style="display: none;">API Key: <span id="api-key-value">Loading...</span> (Pro only)</li>
            </ul>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 DeFiGuard AI. Built with FastAPI & Grok.</p>
        <!-- ID 9: Removed <p>Upgrade for unlimited audits: <a href="/upgrade">Details</a></p> -->
    </footer>

    <script src="/static/script.js?_=${Date.now()}"></script>
</body>
</html>